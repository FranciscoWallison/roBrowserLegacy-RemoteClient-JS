<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>roBrowser Remote Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        .status-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        .status-ok {
            background-color: #d4edda;
            border-color: #28a745;
        }
        .status-warning {
            background-color: #fff3cd;
            border-color: #ffc107;
        }
        .status-error {
            background-color: #f8d7da;
            border-color: #dc3545;
        }
        .status-header {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-icon {
            font-size: 1.5em;
        }
        .info {
            background-color: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin: 20px 0;
        }
        .warning {
            background-color: #fff3e0;
            padding: 15px;
            border-left: 4px solid #ff9800;
            margin: 20px 0;
        }
        .error {
            background-color: #ffebee;
            padding: 15px;
            border-left: 4px solid #f44336;
            margin: 20px 0;
        }
        code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        ul {
            line-height: 1.8;
        }
        .detail-list {
            margin-top: 10px;
            padding-left: 20px;
        }
        .detail-item {
            margin: 5px 0;
            font-size: 0.9em;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }
        .badge-success {
            background-color: #28a745;
            color: white;
        }
        .badge-warning {
            background-color: #ffc107;
            color: #333;
        }
        .badge-error {
            background-color: #dc3545;
            color: white;
        }
        .grf-builder-guide {
            background-color: #e8f5e9;
            padding: 15px;
            border-left: 4px solid #4caf50;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ roBrowser Remote Client</h1>

        <!-- Status de Valida√ß√£o -->
        <div id="validation-status" class="status-card">
            <div class="loading">‚è≥ Carregando status do sistema...</div>
        </div>

        <h2>üìã Setup Instructions</h2>
        <p>This is a remote client server for roBrowser. To get started:</p>

        <ol>
            <li>Instale as depend√™ncias: <code>npm install</code></li>
            <li>Configure as vari√°veis de ambiente no arquivo <code>.env</code></li>
            <li>Place your GRF files in the <code>resources/</code> directory</li>
            <li>Edit the <code>resources/DATA.INI</code> file to list your GRF files:
                <pre><code>[Data]
0=rdata.grf
1=data.grf</code></pre>
            </li>
            <li>Copy your <code>BGM/</code>, <code>data/</code>, and <code>System/</code> folders to the project root</li>
            <li>Execute o diagn√≥stico: <code>npm run doctor</code></li>
            <li>Start the server: <code>npm start</code></li>
        </ol>

        <div class="grf-builder-guide">
            <strong>‚ö†Ô∏è IMPORTANTE: Compatibilidade de GRF</strong>
            <p>Este projeto s√≥ trabalha com GRF vers√£o <strong>0x200</strong> sem criptografia DES.</p>
            <p>Para garantir compatibilidade, reempacote seus GRFs com o GRF Builder:</p>
            <ol style="margin-top: 10px;">
                <li>Baixe o <a href="https://github.com/Tokeiburu/GRFEditor" target="_blank">GRF Builder/Editor</a></li>
                <li>Abra o GRF Builder</li>
                <li>V√° em: <strong>File ‚Üí Options ‚Üí Repack type ‚Üí Decrypt</strong></li>
                <li>Clique em: <strong>Tools ‚Üí Repack</strong></li>
                <li>Aguarde a conclus√£o e substitua o arquivo original</li>
            </ol>
            <p style="margin-top: 10px;">Isso garante que os GRFs fiquem no formato correto (0x200 / sem DES).</p>
        </div>

        <h2>üîå API Endpoints</h2>
        <ul>
            <li><strong>GET /api/health</strong> - Status de valida√ß√£o do sistema</li>
            <li><strong>GET /list-files</strong> - List all available files</li>
            <li><strong>POST /search</strong> - Search for files (if enabled)</li>
            <li><strong>GET /*</strong> - Get any file from GRF or filesystem</li>
        </ul>

        <h2>ü©∫ Diagn√≥stico</h2>
        <p>Execute o comando <code>npm run doctor</code> para validar:</p>
        <ul>
            <li>‚úì Depend√™ncias instaladas (Node.js, npm, packages)</li>
            <li>‚úì Vari√°veis de ambiente configuradas</li>
            <li>‚úì Arquivos e pastas obrigat√≥rios</li>
            <li>‚úì Compatibilidade dos arquivos GRF (vers√£o 0x200, sem DES)</li>
        </ul>

        <h2>üìö Documentation</h2>
        <p>For more information, check the <a href="https://github.com/MrAntares/roBrowserLegacy" target="_blank">roBrowser documentation</a></p>
    </div>

    <script>
        // Buscar e exibir status de valida√ß√£o
        async function loadValidationStatus() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();

                const statusDiv = document.getElementById('validation-status');

                if (data.status === 'ok') {
                    statusDiv.className = 'status-card status-ok';
                    statusDiv.innerHTML = `
                        <div class="status-header">
                            <span class="status-icon">‚úÖ</span>
                            <span>Sistema Validado</span>
                            ${data.hasWarnings ? '<span class="badge badge-warning">' + data.summary.warnings + ' avisos</span>' : ''}
                        </div>
                        <div class="detail-list">
                            <div class="detail-item">‚úì Depend√™ncias instaladas</div>
                            <div class="detail-item">‚úì Vari√°veis de ambiente configuradas</div>
                            <div class="detail-item">‚úì Arquivos obrigat√≥rios encontrados</div>
                            <div class="detail-item">‚úì GRFs compat√≠veis (vers√£o 0x200, sem DES)</div>
                        </div>
                        ${data.hasWarnings ? '<div style="margin-top: 10px; font-size: 0.9em; color: #856404;">‚ö†Ô∏è ' + data.summary.warnings + ' aviso(s) encontrado(s). Execute <code>npm run doctor</code> para detalhes.</div>' : ''}
                    `;
                } else {
                    statusDiv.className = 'status-card status-error';
                    statusDiv.innerHTML = `
                        <div class="status-header">
                            <span class="status-icon">‚ùå</span>
                            <span>Erros de Valida√ß√£o</span>
                            <span class="badge badge-error">${data.summary.errors} erros</span>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Erros encontrados:</strong>
                            <div class="detail-list">
                                ${data.messages.errors.map(err => '<div class="detail-item">‚ùå ' + err.replace(/\n/g, '<br>&nbsp;&nbsp;&nbsp;&nbsp;') + '</div>').join('')}
                            </div>
                        </div>
                        ${data.summary.warnings > 0 ? `
                        <div style="margin-top: 15px;">
                            <strong>Avisos:</strong>
                            <div class="detail-list">
                                ${data.messages.warnings.map(warn => '<div class="detail-item">‚ö†Ô∏è ' + warn + '</div>').join('')}
                            </div>
                        </div>
                        ` : ''}
                        <div style="margin-top: 15px; padding: 10px; background-color: #fff; border-radius: 4px;">
                            <strong>üí° Solu√ß√£o:</strong> Execute <code>npm run doctor</code> para diagn√≥stico completo e instru√ß√µes de corre√ß√£o.
                        </div>
                    `;
                }

                // Atualizar timestamp
                const timestamp = new Date(data.timestamp).toLocaleString('pt-BR');
                statusDiv.innerHTML += `<div style="margin-top: 15px; font-size: 0.85em; color: #666; text-align: right;">√öltima verifica√ß√£o: ${timestamp}</div>`;

            } catch (error) {
                const statusDiv = document.getElementById('validation-status');
                statusDiv.className = 'status-card status-warning';
                statusDiv.innerHTML = `
                    <div class="status-header">
                        <span class="status-icon">‚ö†Ô∏è</span>
                        <span>N√£o foi poss√≠vel carregar o status</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9em;">
                        Erro: ${error.message}
                    </div>
                `;
            }
        }

        // Carregar status ao abrir a p√°gina
        loadValidationStatus();

        // Atualizar status a cada 30 segundos
        setInterval(loadValidationStatus, 30000);
    </script>
</body>
</html>
